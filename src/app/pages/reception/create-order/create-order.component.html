<hq-alerter [service]="alerter"></hq-alerter>
<div class="card">
  <div class="card-header">
    创建工单
    <input container="body" type="text" value="我的挂单 ({{unsettledOrders?.length}})" #pop="bs-popover" readonly placement="bottom"
      [popover]="popTemplate" class="pull-right btn btn-sm textInputBtn" style="margin-right: 55px;">
    <!--挂单列模板-->
    <template #popTemplate>
      <div class="list-group">
        <a *ngFor="let order of unsettledOrders" (click)="loadOrderInfo(order, pop)" class="list-group-item list-group-item-action">
          <span class="mr-2">{{order.carOwner}}</span>
          <span class="mr-2">{{order.carOwnerPhone}}</span>
          <span class="mr-2">{{order.carNo}}</span>
        </a>
      </div>
    </template>
  </div>

  <!--填写工单信息表单-->
  <div class="card-block">
    <form [formGroup]="createWorkSheetForm" (ngSubmit)="onSerarch()">
      <!--工单基本筛选条件面板-->
      <div class="form-group row">
        <label for="carNo" class="col-sm-1 col-form-label col-form-label-sm"><span class="asterisk mr-1">*</span>车牌号</label>
        <div class="col-sm-2">
          <input type="text" class="form-control form-control-sm" formControlName="carNo" id="carNo" placeholder="车牌号">
        </div>
        <label for="carOwner" class="col-sm-1 col-form-label col-form-label-sm"><span class="asterisk mr-1">*</span>车主</label>
        <div class="col-sm-2">
          <input type="text" class="form-control form-control-sm" formControlName="carOwner" id="carOwner" placeholder="车主">
        </div>
        <label for="carOwnerPhone" class="col-sm-1 col-form-label col-form-label-sm">车主电话</label>
        <div class="col-sm-2">
          <input type="text" class="form-control form-control-sm" formControlName="carOwnerPhone" id="carOwnerPhone" placeholder="车主电话">
        </div>
      </div>
      <hr>
      <div class="form-group row">
        <label for="createOrderTime" class="col-sm-1 col-form-label col-form-label-sm">开单时间</label>
        <div class="col-sm-2">
          <input type="text" readonly class="form-control form-control-sm" formControlName="createOrderTime" id="createOrderTime">
        </div>
        <label for="sender" class="col-sm-1 col-form-label col-form-label-sm"><span class="asterisk mr-1">*</span>送修人</label>
        <div class="col-sm-2">
          <input type="text" class="form-control form-control-sm" formControlName="sender" id="sender" placeholder="送修人">
        </div>
        <label for="senderPhone" class="col-sm-1 col-form-label col-form-label-sm"><span class="asterisk mr-1"></span>送修人电话</label>
        <div class="col-sm-2">
          <input type="tel" class="form-control form-control-sm" formControlName="senderPhone" id="senderPhone" placeholder="送修人电话">
        </div>
        <label for="serviceConsultant" class="col-sm-1 col-form-label col-form-label-sm">服务顾问</label>
        <div class="col-sm-2">
          <input type="text" readonly class="form-control form-control-sm" formControlName="serviceConsultant" id="serviceConsultant">
        </div>
      </div>
      <div class="form-group row">
        <label for="introducer" class="col-sm-1 col-form-label col-form-label-sm">介绍人</label>
        <div class="col-sm-2">
          <input type="text" class="form-control form-control-sm" formControlName="introducer" id="introducer" placeholder="介绍人">
        </div>
        <label for="introducerPhone" class="col-sm-1 col-form-label col-form-label-sm">介绍人电话</label>
        <div class="col-sm-2">
          <input type="text" class="form-control form-control-sm" formControlName="introducerPhone" id="introducerPhone" placeholder="介绍人电话">
        </div>
        <label for="carBrand" class="col-sm-1 col-form-label col-form-label-sm"><span class="asterisk mr-1">*</span>品牌</label>
        <div class="col-sm-2">
          <input type="text" class="form-control form-control-sm" formControlName="carBrand" id="carBrand" placeholder="品牌">
        </div>
        <label for="carSeries" class="col-sm-1 col-form-label col-form-label-sm"><span class="asterisk mr-1">*</span>车系</label>
        <div class="col-sm-2">
          <input type="text" class="form-control form-control-sm" formControlName="carSeries" id="carSeries" placeholder="车系">
        </div>
      </div>
      <div class="form-group row">
        <label for="carType" class="col-sm-1 col-form-label col-form-label-sm"><span class="asterisk mr-1">*</span>车型</label>
        <div class="col-sm-2">
          <input type="text" class="form-control form-control-sm" formControlName="carType" id="carType" placeholder="车型">
        </div>
        <label for="vin" class="col-sm-1 col-form-label col-form-label-sm"><span class="asterisk mr-1">*</span>VIN</label>
        <div class="col-sm-2">
          <input type="text" class="form-control form-control-sm" formControlName="vin" id="vin" placeholder="VIN">
        </div>
        <label for="carCheckOutDate" class="col-sm-1 col-form-label col-form-label-sm">验车日期</label>
        <div class="input-group input-group-sm col-sm-2">
          <input class="form-control form-control-sm datetime-picker" type="text" readonly formControlName="carCheckOutDate" ngui-datetime-picker
            date-format="YYYY-MM-DD" date-only="true" />
          <span class="input-group-addon">
            <i class="fa fa-calendar" aria-hidden="true"></i>
          </span>
        </div>
      </div>
      <hr>
      <div class="form-group row">
        <label for="repairType" class="col-sm-1 col-form-label col-form-label-sm"><span class="asterisk mr-1">*</span>维修类型</label>
        <div class="col-sm-2">
          <select id="repairType" formControlName="repairType" class="form-control form-control-sm">
            <option value="1" selected>一般维修</option>
            <option value="2">保养</option>
            <option value="3">事故</option>
            <option value="4">索赔</option>
            <option value="5">免费检测</option>
          </select>
        </div>
        <label for="predictedFinishTime" class="col-sm-2 col-form-label col-form-label-sm">预计交车日期</label>
        <div class="input-group input-group-sm col-sm-3">
          <input class="form-control form-control-sm datetime-picker" type="text" readonly formControlName="predictedFinishTime" ngui-datetime-picker date-format="YYYY-MM-DD hh:mm" hour="23" minute='59' close-on-select="false" />
          <span class="input-group-addon">
                <i class="fa fa-calendar" aria-hidden="true"></i>
              </span>
        </div>
        <label for="mileage" class="col-sm-1 col-form-label col-form-label-sm"><span class="asterisk mr-1">*</span>行驶里程</label>
        <div class="input-group input-group-sm col-sm-2">
          <input type="text" class="form-control form-control-sm" formControlName="mileage" id="mileage">
          <span class="input-group-addon">KM</span>
        </div>
      </div>
      <div class="form-group row">
        <label for="previousEntryTime" class="col-sm-1 col-form-label col-form-label-sm">上次进店时间</label>
        <div class="col-sm-2">
          <input type="text" readonly class="form-control form-control-sm" formControlName="previousEntryTime" id="previousEntryTime">
        </div>
        <label for="suggestedNextMaintenanceTime" class="col-sm-2 col-form-label col-form-label-sm">建议下次保养日期</label>
        <div class="input-group input-group-sm col-sm-3">
          <input class="form-control form-control-sm datetime-picker" type="text" readonly formControlName="suggestedNextMaintenanceTime" ngui-datetime-picker date-format="YYYY-MM-DD hh:mm" hour="23" minute='59' close-on-select="false" />
          <span class="input-group-addon">
                <i class="fa fa-calendar" aria-hidden="true"></i>
              </span>
        </div>
        <label for="repairStation" class="col-sm-1 col-form-label col-form-label-sm">维修工位</label>
        <div class="col-sm-2">
          <input type="text" class="form-control form-control-sm" formControlName="repairStation" id="repairStation">
        </div>
      </div>
      <div class="form-group row">
        <label for="previousEntryMileage" class="col-sm-1 col-form-label col-form-label-sm">上次进店里程</label>
        <div class="input-group input-group-sm col-sm-2">
          <input type="text" class="form-control form-control-sm" formControlName="previousEntryMileage" id="previousEntryMileage">
          <span class="input-group-addon">KM</span>
        </div>
        <label for="suggestedNextMaintenanceMileage" class="col-sm-2 col-form-label col-form-label-sm">建议下次保养里程</label>
       <div class="input-group input-group-sm col-sm-3">
          <input type="text" class="form-control form-control-sm" formControlName="suggestedNextMaintenanceMileage" id="suggestedNextMaintenanceMileage">
          <span class="input-group-addon">KM</span>
        </div>
      </div>
    </form>
    <hr>

    <tabset #staticTabs>
      <tab>
        <template tabHeading>
          <span class="asterisk mr-1">*</span>维修项目
        </template>
        <smart-table (createConfirm)="addNewmaintanceItem($event)" [settings]="maintanceItemSettings" [source]="maintenanceProjectData" ></smart-table>
      </tab>
      <tab>
        <template tabHeading>
          <span class="asterisk mr-1">*</span>维修配件
        </template>
        <smart-table [settings]="maintanceFixingsSettings" [source]="maintenanceFixingsData"></smart-table>
      </tab>
      <tab heading="附加项目">
        <smart-table [settings]="addsOnItemSettings"></smart-table>
      </tab>
      <tab heading="建议维修项">
        <smart-table [settings]="suggestedMaintanceSettings"></smart-table>
      </tab>
      <tab heading="历史维修记录">
        <smart-table [settings]="maintanceItemSettings"></smart-table><br>
        <smart-table [settings]="maintanceFixingsSettings"></smart-table><br>
        <smart-table [settings]="addsOnItemSettings"></smart-table><br>
        <smart-table [settings]="suggestedMaintanceSettings"></smart-table>
      </tab>
      <tab heading="客户回访记录">
        <smart-table [settings]="returnVisitSettings"></smart-table>
      </tab>
    </tabset>

    <!--只有前4个选项卡显示-->
    <div *ngIf="true" class="card">
      <div class="card-header" style="font-size:smaller;color:gray;padding: 3px 5px;">
        折前费用: 工时费
        <span class="ml-2 mr-2">745</span> | 材料费
        <span class="ml-2 mr-2">1</span> | 套餐费
        <span class="ml-2 mr-2">45</span> | 附加项目费
        <span class="ml-2 mr-2">646</span> | 合计
        <span class="ml-2 mr-2">165655</span>|
      </div>
      <div class="card-block text-center">
        <input type="text" readonly class="btn textInputBtn" value="生成订单">
        <input type="text" readonly class="btn textInputBtn" value="挂单">
      </div>
    </div>
  </div>