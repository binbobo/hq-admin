<ng-template hq-alerter></ng-template>
<div class="card business">
  <div class="card-header">维修历史</div>
  <div class="card-block">
    <form [formGroup]="businessForm" (ngSubmit)="onSearch()">
      <div class="form-group row">
        <label for="plateNo" class="col-form-label margin-l">车牌号：</label>
        <div class="col-2">
        <input [(ngModel)]="params.plateNo" formControlName="plateNo" [hqTableTypeahead]="plateNotypeaheadSource" [columns]="typeaheadColumns"
          (onSelect)="plateNoOnSelect($event)" class="form-control" id="plateNo" type="text" placeholder="请输入车牌号" />
        </div>
        <label for="enterTime" class="col-form-label margin-l">进店时间：</label>
        <div class="col-3">
        <input [close-on-select]="false" [(ngModel)]="params.enterStartTimeDate" formControlName="enterStartTimeDate" class="form-control datetime-picker"
          id="enterStartTimeDate" type="text" ngui-datetime-picker date-format="YYYY-MM-DD hh:mm" hour="23" minute='59' />
        </div>
        <label class="col-form-label">至：</label>
        <div class="col-3">
        <input [close-on-select]="false" [(ngModel)]="params.enterEndTimeDate" formControlName="enterEndTimeDate" class="form-control datetime-picker"
          id="enterEndTimeDate" type="text" ngui-datetime-picker date-format="YYYY-MM-DD hh:mm" hour="23" minute='59'/>
        </div>
      </div>
      <div class="form-group row">
        <label for="leaveTime" class="col-form-label margin-l">出厂时间：</label>
        <div class="col-3">
        <input [close-on-select]="false" [(ngModel)]="params.leaveStartTimeDate" formControlName="leaveStartTimeDate" class="form-control datetime-picker"
          id="leaveStartTimeDate" type="text" ngui-datetime-picker date-format="YYYY-MM-DD hh:mm" hour="23" minute='59' />
        </div>
        <label class="col-form-label">至：</label>
        <div class="col-3">
        <input [close-on-select]="false" [(ngModel)]="params.leaveEndTimeDate" formControlName="leaveEndTimeDate" class="form-control datetime-picker"
          id="leaveEndTimeDate" type="text" ngui-datetime-picker date-format="YYYY-MM-DD hh:mm" hour="23" minute='59' />
        </div>
        <label *ngIf="isShow" for="orgName" class="col-form-label margin-l">查询范围：</label>
        <select *ngIf="isShow" name="orgName" id="orgName" class="form-control col-2">
            <option value="1">总店的</option>
          </select>
        <div class="col-1">
          <button type="submit" class="btn btn-primary">查询</button>
        </div>
      </div>
    </form>
    <hr>
    <h5 *ngIf="isSearch">温馨提示：系统找到该车辆在本店维修过<span class="color">{{total}}</span>次</h5>
    <hr>
    <table class="table table-striped table-bordered">
      <thead>
        <tr>
          <th>操作</th>
          <th>维修类型</th>
          <th>工单号</th>
          <th>进店时间</th>
          <th>预计交车时间</th>
          <th>超时</th>
          <th>服务顾问</th>
          <th>品牌</th>
          <th>车型</th>
          <th>VIN</th>
          <th>车牌号</th>
          <th>行驶里程</th>
          <th>购车时间</th>
          <th>车主</th>
          <th>送修人</th>
          <th>送修人电话</th>
          <th>介绍人</th>
          <th>介绍人电话</th>
          <th>维修技师</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of list">
          <td width="75">
            <a href="javascript:void(0)" (click)="businessDetailsHandler($event, item.id, bdModal)">详情</a>
          </td>
          <td>{{item.typeName}}</td>
          <td>{{item.billCode}}</td>
          <td>{{item.createdOnUtc|date:"yyyy/MM/dd HH:mm:ss"}}</td>
          <td>{{item.expectLeave|date:"yyyy/MM/dd HH:mm:ss"}}</td>
          <td>{{item.overTime}}</td>
          <td>{{item.createdUserName}}</td>
          <td>{{item.brand}}</td>
          <td>{{item.model}}</td>
          <td>{{item.vin}}</td>
          <td>{{item.plateNo}}</td>
          <td>{{item.mileage}}</td>
          <td>{{item.purchaseDate|date:"yyyy/MM/dd HH:mm:ss"}}</td>
          <td>{{item.customerName}}</td>
          <td>{{item.contactUser}}</td>
          <td>{{item.contactInfo}}</td>
          <td>{{item.introducer}}</td>
          <td>{{item.introPhone}}</td>
          <td>{{item.employeeNames}}</td>
        </tr>
      </tbody>
      <tfoot *ngIf="list?.length <= 0">
        <tr>
          <td colspan="19">查询结果为空</td>
        </tr>
      </tfoot>
    </table>
    <hq-pagination [loading]="loading" [totalItems]="total" [(currentPage)]="index" (pageChanged)="onPageChanged($event)"></hq-pagination>
  </div>
  <div class="card-footer">
    <button type="button" (click)="onExport()" class="btn btn-secondary">导出</button>
  </div>
</div>

<div class="modal fade" bsModal #bdModal="bs-modal" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <p class="modal-title mg">维修历史</p>
        <button class="close pull-right" (click)="bdModal.hide()">&times;</button>
      </div>
      <div class="modal-body">
        <hq-business-detail></hq-business-detail>
      </div>
    </div>
  </div>
</div>