<ng-template hq-alerter></ng-template>
<div class="maintain card">
  <div class="card-header">
    <span>维修退料</span>
    <ng-template hqSuspendBill="MR" (onSelect)="onSuspendSelect($event)" [columns]="columns"></ng-template>
  </div>
  <div class='card-block'>
    <div>
      <form class="form-in serach-input">
        <input [hqTableTypeahead]="PlatNoSource" [columns]="typeaheadColumns" (onSelect)="onPlateNoSelect($event)" class="form-control input-left"
          placeholder="请输入车牌号/工单号/车主姓名">
        <span class='button-right'>
        </span>
      </form>
    </div>
    <div class="serach-main">
      <div class="serach-list">车主:&nbsp;&nbsp;{{orderDetail?.customerName}}</div>
      <div class="serach-list">VIN:&nbsp;&nbsp;{{orderDetail?.vin}}</div>
      <div class="serach-list">维修类型:&nbsp;&nbsp;{{orderDetail?.typeName}}</div>
      <div class="serach-list">开单时间：&nbsp;&nbsp;{{orderDetail?.createdOnUtc |date:"yyyy/MM/dd HH:mm:ss"}}</div>
    </div>
    <!--维修项目-->
    <div class="tab-title">维修项目</div>
    <table class="table   table-striped table-bordered">
      <thead>
        <tr>
          <th>序号</th>
          <th>维修项目</th>
          <th>维修技师</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor='let item of serviceData;let index=index'>
          <td>{{index+1}}</td>
          <td>{{item.serviceName}}</td>
          <td>{{item.employeeNames}}</td>
        </tr>
      </tbody>
    </table>

    <div class="tab-title">维修退料</div>
    <table class="table  table-striped table-bordered">
      <thead>
        <tr>
          <th>操作</th>
          <th>流水号</th>
          <th>序号</th>
          <th>维修项目</th>
          <th>品牌</th>
          <th>配件编码</th>
          <th>配件名称</th>
          <th>规格型号</th>
          <th>车型</th>
          <th>仓库</th>
          <th>库位</th>
          <th>*数量（个）</th>
          <th>单价（元/个）</th>
          <th>金额（元）</th>
          <!--<th>备注</th>-->
          <th>领料人</th>

        </tr>
      </thead>
      <tbody *ngFor="let item of serialData">
        <tr *ngFor="let ele of item.list">
          <td><button class="btn btn-primary" (click)="OnCreatBound(ele)">退料</button></td>
          <td>{{item.serialNum}}</td>
          <td>{{ele.number}}</td>
          <td>{{ele.serviceName}}</td>
          <td>{{ele.brandName}}</td>
          <td>{{ele.productCode}}</td>
          <td>{{ele.productName }}</td>
          <td>{{ele.productSpecification}}</td>
          <td>{{ele.vihicleName}}</td>
          <td>{{ele.storeName}}</td>
          <td>{{ele.locationName}}</td>
          <td>{{ele.count}}</td>
          <td>{{ele.price|centToYuan}}</td>
          <td>{{ele.amount|centToYuan}}</td>
          <!--<td>{{ele.description}}</td>-->
          <td>{{ele.takeUser}}</td>

      </tbody>
    </table>

    <!--维修退料-->
    <div *ngIf="newMainData.length>0">
      <div class="tab-title">新增维修退料</div>
      <table class="table   table-striped table-bordered">
        <thead>
          <tr>
            <th>操作</th>
            <th>序号</th>
            <th>维修项目</th>
            <th>品牌</th>
            <th>配件编码</th>
            <th>配件名称</th>
            <th>规格型号</th>
            <th>车型</th>
            <th>仓库</th>
            <th>库位</th>
            <th>数量（个）</th>
            <th>单价（元/个）</th>
            <th>金额（元）</th>
            <!--<th>备注</th>-->
            <th>退料人</th>

          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let ele of newMainData;let i=index">
            <td><button class="btn btn-danger" (click)="onDelCreat(i)">删除</button></td>
            <td>{{i+1}}</td>
            <td>{{ele.serviceName}}</td>
            <td>{{ele.brandName}}</td>
            <td>{{ele.productCode}}</td>
            <td>{{ele.productName }}</td>
            <td>{{ele.productSpecification}}</td>
            <td>{{ele.vihicleName}}</td>
            <td>{{ele.storeName}}</td>
            <td>{{ele.locationName}}</td>
            <td>-{{ele.count}}</td>
            <td>{{ele.price|centToYuan}}</td>
            <td>{{ele.amount|centToYuan}}</td>
            <!--<td>{{ele.description}}</td>-->
            <td>{{ele.returnUser}}</td>

          </tr>
        </tbody>
      </table>
    </div>

    <div class="tab-title">维修退料记录</div>
    <table class="table   table-striped table-bordered">
      <thead>
        <tr>
          <th>流水号</th>
          <th>序号</th>
          <th>维修项目</th>
          <th>品牌</th>
          <th>配件编码</th>
          <th>配件名称</th>
          <th>规格型号</th>
          <th>车型</th>
          <th>仓库</th>
          <th>库位</th>
          <th>*数量（个）</th>
          <th>单价（元/个）</th>
          <th>金额（元）</th>
          <!--<th>备注</th>-->
          <th>退料人</th>
        </tr>
      </thead>
      <tbody *ngFor="let item of mrData">
        <tr *ngFor="let ele of item.list">
          <td>{{item.serialNum}}</td>
          <td>{{ele.number}}</td>
          <td>{{ele.serviceName}}</td>
          <td>{{ele.brandName}}</td>
          <td>{{ele.productCode}}</td>
          <td>{{ele.productName }}</td>
          <td>{{ele.productSpecification}}</td>
          <td>{{ele.vihicleName}}</td>
          <td>{{ele.storeName}}</td>
          <td>{{ele.locationName}}</td>
          <td>{{ele.count}}</td>
          <td>{{ele.price|centToYuan}}</td>
          <td>{{ele.amount|centToYuan}}</td>
          <!--<td>{{ele.description}}</td>-->
          <td>{{ele.returnUser}}</td>
      </tbody>
    </table>
  </div>
  <!--提交按钮-->
  <div class="card-footer text-muted">
    <button class="btn btn-primary" (click)="OnCreatReturnBill()">生成维修退料单</button>
    <button class="btn btn-secondary" (click)="finishedOrder($event,  confirmModal)">取消</button>
    <button class="btn btn-success" (click)="suspend()">挂单</button>
    <button class="btn btn-secondary " options="printOptions" (onConfirm)="onConfirmNumber($event)" [hqMutilSelect]="numberPrintList"
      title="选择流水号" href="#" placement="right">打印</button>
  </div>

  <!--提示是否确认退出-->
  <div bsModal #confirmModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-sm">
      <div class="modal-content">
        <div class="modal-header">
          <p class="modal-title">温馨提示</p>
          <button type="button" class="close pull-right" aria-label="Close" (click)="confirmModal.hide();">
          <span aria-hidden="true">&times;</span>
        </button>
        </div>
        <div class="modal-body">
          <p>您确定要取消退料吗</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-sm" data-dismiss="confirmModal" (click)="confirmModal.hide();">取消</button>
          <button type="button" class="btn btn-sm" data-dismiss="modal" (click)="onConfirmFinished(confirmModal);">确定</button>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" bsModal #createModal="bs-modal" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title pull-left">新增</h5>
        <button class="close pull-right" (click)="createModal.hide()">&times;</button>
      </div>
      <div class="modal-body">
        <hq-maintain-creat *ngIf="isShowCreat" [inputData]="inputData" (formSubmit)="onCreate($event)"></hq-maintain-creat>
      </div>
    </div>
  </div>
</div>