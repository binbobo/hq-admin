<ng-template hq-alerter></ng-template>
<div class="distribute card">
  <div class="card-header">
    <span>维修发料</span>
    <ng-template hqSuspendBill="RM"  (onSelect)="onSuspendSelect($event)" [columns]="columns"></ng-template>
  </div>
  <div class="card-block">
    <div>
      <form class="form-in serach-input">
        <input [hqTableTypeahead]="PlatNoSource" [(ngModel)]="initValue" name="initValue" [columns]="typeaheadColumns" (onSelect)="onPlateNoSelect($event)" class="form-control input-left"
          placeholder="请输入车牌号/工单号">
        <span class='button-right'>
        </span>
      </form>
    </div>
    <div class="serach-main">
      <div class="serach-list">工单号:&nbsp;&nbsp;{{orderDetail?.billCode}}</div>
      <div class="serach-list">车主:&nbsp;&nbsp;{{orderDetail?.customerName}}</div>
    </div>
    <div class="serach-main">
      <div class="serach-list">车型:&nbsp;&nbsp;{{orderDetail?.vehicleName}}</div>
      <div class="serach-list">VIN:&nbsp;&nbsp;{{orderDetail?.vin}}</div>
      <div class="serach-list">维修类型:&nbsp;&nbsp;{{orderDetail?.typeName}}</div>
      <div class="serach-list">开单时间：&nbsp;&nbsp;{{orderDetail?.createdOnUtc |sDatetime}}</div>
    </div>
    <div [hqSpinner]="serviceShow" *ngIf="serviceData?.length>0">
      <div class="tab-title">
        维修项目
      </div>
      <div class="table-container">
        <table class="table  table-striped table-bordered">
          <thead>
            <tr>
              <th>操作</th>
              <th>维修项目</th>
              <th>维修技师</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor='let item of serviceData;let index=index'>
              <td><button class="btn btn-primary" (dataName)="item.serviceName" [disabled]="!(item.maintenanceEmployees.length>0)"
                  (click)="OnCreatBound(item)">发料</button></td>
              <td>{{item.serviceName}}<span *ngIf="item.type === 3" class="append-stamp">增项</span></td>
              <td>
                <span *ngIf="item.employeeNames">{{item?.employeeNames.join(',')}}</span>
                <span *ngIf="item.turnEmployeeNames">{{item?.turnEmployeeNames.join(',')}}</span></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <div *ngIf="newMainData.length>0">
      <div class="tab-title">
        新增维修发料
      </div>
      <div class="table-container">
        <table class="table  table-striped table-borderd">
          <thead>
            <tr>
              <th>操作</th>
              <th>维修项目</th>
              <th>配件编码</th>
              <th>配件分类</th>
              <th>配件名称</th>
              <th>品牌</th>
              <th>规格型号</th>
              <th>单位</th>
              <th>适用车型</th>
              <th>仓库</th>
              <th>库位</th>
              <th>数量</th>
              <th>单价（元）</th>
              <th>金额（元）</th>
              <th>备注</th>
              <th>领料人</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let ele of newMainData;let i=index">
              <td><button class="btn btn-danger" (click)="onDelCreat(i)">删除</button></td>
              <td>{{ele.serviceName}}</td>
              <td>{{ele.productCode}}</td>
              <td>{{ele.productCategory}}</td>
              <td>{{ele.productName }}</td>
              <td>{{ele.brandName}}</td>
              <td>{{ele.productSpecification}}</td>
              <td>{{ele.productUnit}}</td>
              <td>{{ele.vihicleName}}</td>
              <td>{{ele.storeName}}</td>
              <td>{{ele.locationName}}</td>
              <td>{{ele.count}}</td>
              <td>{{ele.price|centToYuan}}</td>
              <td>{{ele.amount|centToYuan}}</td>
              <td>{{ele.description}}</td>
              <td>{{ele.createUserName}}</td>

            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <div [hqSpinner]="serialShow">
      <tabset #staticTabs *ngIf="serialData?.length>0">
        <tab heading="维修发料记录">
          <table class="table  table-striped table-bordered">
            <thead>
              <tr>
                <th>流水号</th>
                <th>维修项目</th>
                <th>配件编码</th>
                <th>配件分类</th>
                <th>配件名称</th>
                <th>品牌</th>
                <th>规格型号</th>
                <th>单位</th>
                <th>适用车型</th>
                <th>仓库</th>
                <th>库位</th>
                <th>数量</th>
                <th>单价（元）</th>
                <th>金额（元）</th>
                <th>备注</th>
                <th>领料人</th>
              </tr>
            </thead>
            <tbody *ngFor="let item of serialData">
              <tr *ngFor="let ele of item.list">
                <td>{{item.serialNum}}</td>
                <td>{{ele.serviceName}}</td>
                <td>{{ele.productCode}}</td>
                <td>{{ele.productCategory}}</td>
                <td>{{ele.productName }}</td>
                <td>{{ele.brandName}}</td>
                <td>{{ele.productSpecification?ele.productSpecification:ele.specifications}}</td>
                <td>{{ele.productUnit}}</td>
                <td>{{ele.vihicleName?ele.vihicleName:ele.vehicleModel}}</td>
                <td>{{ele.storeName?ele.storeName:ele.storeHouse}}</td>
                <td>{{ele.locationName}}</td>
                <td>{{ele.count}}</td>
                <td>{{ele.price|centToYuan}}</td>
                <td>{{ele.amount|centToYuan}}</td>
                <td>{{ele.description}}</td>
                <td>{{ele.takeUser}}</td>
              </tr>
            </tbody>
          </table>
        </tab>
        <tab heading="维修退料记录" *ngIf="MRData?.length>0">
          <table class="table table-striped table-bordered">
            <thead>
              <tr>
                <th>流水号</th>
                <th>维修项目</th>
                <th>配件编码</th>
                <th>配件分类</th>
                <th>配件名称</th>
                <th>品牌</th>
                <th>规格型号</th>
                <th>单位</th>
                <th>适用车型</th>
                <th>仓库</th>
                <th>库位</th>
                <th>数量</th>
                <th>单价（元）</th>
                <th>金额（元）</th>
                <th>备注</th>
                <th>退料人</th>
              </tr>
            </thead>
            <tbody *ngFor="let item of MRData">
              <tr *ngFor="let ele of item.list">
                <td>{{item.serialNum}}</td>
                <td>{{ele.serviceName}}</td>
                <td>{{ele.productCode}}</td>
                <td>{{ele.productCategory}}</td>
                <td>{{ele.productName }}</td>
                <td>{{ele.brandName}}</td>
                <td>{{ele.productSpecification}}</td>
                <td>{{ele.productUnit}}</td>
                <td>{{ele.vihicleName}}</td>
                <td>{{ele.storeName}}</td>
                <td>{{ele.locationName}}</td>
                <td>{{ele.count}}</td>
                <td>{{ele.price|centToYuan}}</td>
                <td>{{ele.amount|centToYuan}}</td>
                <td>{{ele.description}}</td>
                <td>{{ele.returnUser}}</td>
              </tr>
            </tbody>
          </table>
        </tab>
      </tabset>
    </div>
  </div>
  <div class="card-footer text-muted">
    <button class="btn btn-primary" [disabled]="!(newMainData.length>0)" [hqSpinner]="generat" (click)="OnCreatBill()">生成维修发料单</button>
    <!--<button class="btn btn-secondary" (click)="finishedOrder($event,  confirmModal)">取消</button>-->
    <button class="btn btn-info" [disabled]="!(newMainData.length>0)" (click)="suspend()">挂单</button>
    <button class="btn btn-secondary " options="printOptions" (onConfirm)="onConfirmNumber($event)" [hqMutilSelect]="numberPrintList"
      title="选择流水号" href="#" [disabled]="!(serialData.length>0)" placement="right">打印</button>
  </div>

  <!--提示是否确认退出-->
  <!--<div bsModal #confirmModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-sm">
      <div class="modal-content">
        <div class="modal-header">
          <p class="modal-title">温馨提示</p>
          <button type="button" class="close pull-right" aria-label="Close" (click)="confirmModal.hide();">
          <span aria-hidden="true">&times;</span>
        </button>
        </div>
        <div class="modal-body">
          <p>您确定要取消发料吗</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" data-dismiss="modal" (click)="onConfirmFinished(confirmModal);">确定</button>
          <button type="button" class="btn btn-secondary" data-dismiss="confirmModal" (click)="confirmModal.hide();">取消</button>
        </div>
      </div>
    </div>
  </div>-->
</div>

<div class="modal fade" bsModal #createModal="bs-modal" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title pull-left">新增</h5>
        <button class="close pull-right" (click)="createModal.hide()">&times;</button>
      </div>
      <div class="modal-body">
        <hq-distribute-creat *ngIf="createModal.isShown" [InputData]="InputData" (formSubmit)="onCreate($event)"></hq-distribute-creat>
      </div>
    </div>
  </div>
</div>

<hq-distribute-print *ngIf="printList" [hidden]="true" [data]="printList" hqPrint #printer="hq-print"></hq-distribute-print>